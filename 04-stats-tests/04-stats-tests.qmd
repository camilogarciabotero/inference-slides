---
title: Parametric & Non-Parametric tests
subtitle: "https://bit.ly/3V7CMsZ"
author:
  - name: Camilo G.
    email: ca.garcia2@uniandes.edu.co

  - name: "Alejandra S."
    email: m.soto2@uniandes.edu.co

  - name: "Ronald D."
    email: r.diazf@uniandes.edu.co
format:
  revealjs:
    footer: |
      BIOL2205 - IeI - Universidad de los Andes
    standalone: true
    preview-links: auto
    center: true
    slide-number: true
    fig-align: center
    code-line-numbers: false
    overview: true
    code-link: true
    code-annotations: hover
    highlight-style: ayu
    df-print: paged
    scrollable: true
    fig-height: 6
    fig-width: 6
    fig-dpi: 350
    theme: ../theme.scss
    bibliography: ../references.bib
---

```{r}
#| label: theme-set
#| eval: true
library(tidyverse)
library(palmerpenguins)
library(latex2exp)
library(ggsignif)

simple_theme <- theme_bw() +
    theme(
        plot.background = element_rect(fill = "#FDF6E3"),
        panel.background = element_rect(fill = "#FDF6E3"),
        legend.background = element_rect(fill = "#FDF6E3"),
        legend.position = "top",
        axis.title = element_text(size = 14)
    )

theme_set(simple_theme)
```

# How do we test whether *two* samples are different? {.smaller}

------------------------------------------------------------------------

Do male penguins display greater body sizes than female?

```{r}
#| label: simple-barplot
#| echo: true
#| eval: true
#| fig-align: center
#| output-location: column-fragment
adelie_penguins <- penguins |>
  filter(species == "Adelie") |>
  drop_na()

ggplot(adelie_penguins, aes(x = sex, y = body_mass_g, fill = sex)) +
  geom_boxplot(alpha = 0.5) +
  geom_jitter(width = 0.2) +
  labs(
    y = "Body mass (g)",
    x = ""
  )
```

------------------------------------------------------------------------

::: columns
**Let's try to *test* the resulting hypotheses:**

::: {.column width="50%"}
Null hypothesis: $$H_{0}: \mu_{1} = \mu_{2}$$ **No variation** between means
:::

::: {.column width="50%"}
Alternative hypothesis: $$H_{A}: \mu_{1} \neq \mu_{2}$$ **Variation** between means
:::
:::

##  {auto-animate="true"}

```{r}
#| label: density-plot-01
#| echo: false
#| eval: true
#| fig-align: center
ggplot(adelie_penguins, aes(x = body_mass_g)) +
  geom_density(aes(fill = sex), alpha = 0.5) +
    labs(
    x = "Body mass (g)",
    y = "Density"
  )
```

##  {auto-animate="true"}

```{r}
#| label: density-plot-02
#| echo: false
#| eval: true
#| fig-align: center
ggplot(adelie_penguins, aes(x = body_mass_g)) +
  geom_density(aes(fill = sex), alpha = 0.5) +
    labs(
    x = "Body mass (g)",
    y = "Density"
  ) +
  annotate("text", x = 3640, y = 0.00005, label = "What does this gray area mean?", size = 2.5)
```

## Let's make some important assumptions

1.  The two samples are independent.
2.  Variables display normal distribution.
3.  The two samples display equal variances.

------------------------------------------------------------------------

Then,

```{r}
#| label: density-plot-03
#| echo: false
#| eval: true
#| fig-align: center

ggplot(adelie_penguins, aes(x = body_mass_g)) +
  geom_density(aes(fill = sex), alpha = 0.5) +
    labs(
    x = "Body mass (g)",
    y = "Density"
  ) +
  annotate("text", x = 3220, y = 0.0005, label = TeX(r"($\bar{X}_{1} \sim N(\mu_{1},s^{2}/n_{1})$)"), size = 3) +
  annotate("text", x = 4120, y = 0.0005, label = TeX(r"($\bar{X}_{2} \sim N(\mu_{2},s^{2}/n_{2})$)"), size = 3)
```

------------------------------------------------------------------------

And,

```{r}
#| label: density-plot-04
#| echo: false
#| eval: true
#| fig-align: center

ggplot(adelie_penguins, aes(x = body_mass_g)) +
  geom_density(aes(fill = sex), alpha = 0.5) +
    labs(
    x = "Body mass (g)",
    y = "Density"
  ) +
  annotate("text", x = 3220, y = 0.0005, label = TeX(r"($\bar{X}_{1} \sim N(\mu_{1},s^{2}/n_{1})$)"), size = 3) +
  annotate("text", x = 4120, y = 0.0005, label = TeX(r"($\bar{X}_{2} \sim N(\mu_{2},s^{2}/n_{2})$)"), size = 3) +
  annotate("text", x = 3640, y = 0.00020, label = TeX(r"($\bar{X}_{1} - \bar{X}_{2} )"), size = 4)
```


## The T Distribution {.smaller}

***

:::: columns

::: {.column width="50%" .smaller}

$$
\bar{X}_{1} - \bar{X}_{2} \sim N\Bigg[\mu_{1} - \mu_{2},s^{2}\bigg(\frac{1}{n_{1}}+\frac{1}{n_{2}}\bigg)\Bigg]
$$

If $H_{0}$ is true $\rightarrow$ $\mu_{1} - \mu_{2} = 0$, then


$$
\bar{X}_{1} - \bar{X}_{2} \sim N\Bigg[0,s^{2}\bigg(\frac{1}{n_{1}}+\frac{1}{n_{2}}\bigg)\Bigg]
$$


$$
\frac{\bar{X}_{1} - \bar{X}_{2}}{s\sqrt{\frac{1}{n_{1}}+\frac{1}{n_{2}}}} \sim N(0,1)
$$


$$
\frac{\bar{X}_{1} - \bar{X}_{2}}{s\sqrt{\frac{1}{n_{1}}+\frac{1}{n_{2}}}} = t
$$

:::

::: {.column width="50%"}

:::

::::

. . . 

![](figs/t-test-plot.png){.absolute bottom=200 right=20 width="500"}


# Testing the hypothesis in R

## The parametric *T-test*

A way to test the hypothesis is using the `t.test()` function:

```{r}
#| label: t-test
#| echo: true
#| eval: true
#| output-location: fragment
t.test(body_mass_g ~ sex, adelie_penguins)
```

------------------------------------------------------------------------

Another alternative is to use the `statsExpressions` library:

![](figs/statsexpressions-logo.png){fig-align="center" width="500"}

------------------------------------------------------------------------

```{r}
#| label: t-test-expression
#| echo: true
#| eval: true
#| output-location: fragment
library(statsExpressions)

adelie_ttest_table <- two_sample_test(
  data = adelie_penguins,
  x = sex, 
  y = body_mass_g,
  type = "p",
  paired = FALSE
  )

adelie_ttest_table
```

. . .

## Adding stats to the barplot! {.smaller}

------------------------------------------------------------------------

```{r}
#| label: simple-barplot-stats
#| echo: true
#| eval: true
#| fig-align: center
#| code-line-numbers: "14-17"
#| output-location: column-fragment
ggplot(
  adelie_penguins,
  aes(
    x = sex,
    y = body_mass_g,
    fill = sex
  )
) +
  geom_boxplot(alpha = 0.5) +
  geom_jitter(width = 0.2) +
  labs(
    y = "Body mass (g)",
    x = "",
    subtitle = parse(
      text = adelie_ttest_table$expression
      )
  )
```

***

![From Indrajeet Patil^[https://github.com/IndrajeetPatil/statsExpressions]](figs/stats-template-analysis.png){fig-align="center"}


## Adding comparisons to the plot using `ggsignif` library!

***

```{r}
#| label: simple-barplot-stats-signif
#| echo: true
#| eval: true
#| fig-align: center
#| code-line-numbers: "15-19"
#| output-location: column-fragment
ggplot(adelie_penguins, 
  aes(
    x = sex, 
    y = body_mass_g, 
    fill = sex)) +
  geom_boxplot(alpha = 0.5) +
  geom_jitter(width = 0.2) +
  labs(
    y = "Body mass (g)",
    x = "",
    subtitle = parse(
      text = adelie_ttest_table$expression
      )
  ) + 
  geom_signif(
    comparisons = list(c("female", "male")), 
    test = "t.test",
    map_signif_level = TRUE
  )
```

## The **non-parametric** *Mann-Whitney/Wilcox test*

***

## Let's make some important assumptions

1.  The two samples are independent.
2.  Variables could display non-normal distribution.
3.  The two samples could display different variances (and sample sizes).

------------------------------------------------------------------------


A way to test the hypothesis is using the `wilkox.test()` function:

```{r}
#| label: wilcox
#| echo: true
#| eval: true
#| output-location: fragment
wilcox.test(body_mass_g ~ sex, adelie_penguins, paired = FALSE)
```

***

Another alternative is to use the `statsExpressions` library:

```{r}
#| label: wilcox-expression
#| echo: true
#| eval: true
#| output-location: fragment
library(statsExpressions)

adelie_wilcox_table <- two_sample_test(
  data = adelie_penguins,
  x = sex, 
  y = body_mass_g,
  type = "np",
  paired = FALSE
  )

adelie_wilcox_table
```

## Adding stats to the barplot! {.smaller}

------------------------------------------------------------------------

```{r}
#| label: simple-barplot-stats-wilcox
#| echo: true
#| eval: true
#| fig-align: center
#| code-line-numbers: "14-17"
#| output-location: column-fragment
ggplot(
  adelie_penguins,
  aes(
    x = sex,
    y = body_mass_g,
    fill = sex
  )
) +
  geom_boxplot(alpha = 0.5) +
  geom_jitter(width = 0.2) +
  labs(
    y = "Body mass (g)",
    x = "",
    subtitle = parse(
      text = adelie_wilcox_table$expression
      )
  )
```

## Adding comparisons to the plot using `ggsignif` library!

***

```{r}
#| label: simple-barplot-stats-signif-wilcox
#| echo: true
#| eval: true
#| fig-align: center
#| code-line-numbers: "15-19"
#| output-location: column-fragment
ggplot(adelie_penguins, 
  aes(
    x = sex, 
    y = body_mass_g, 
    fill = sex)) +
  geom_boxplot(alpha = 0.5) +
  geom_jitter(width = 0.2) +
  labs(
    y = "Body mass (g)",
    x = "",
    subtitle = parse(
      text = adelie_wilcox_table$expression
      )
  ) + 
  geom_signif(
    comparisons = list(c("female", "male")), 
    test = "wilcox.test",
    map_signif_level = TRUE
  )
```
